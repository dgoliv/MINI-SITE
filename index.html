<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRUD de Contas a Pagar</title>
    <!-- Adicione os links para o Firebase e o Bootstrap CSS -->
    <script src="https://www.gstatic.com/firebasejs/8.7.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.7.0/firebase-firestore.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <!-- Seu estilo CSS personalizado aqui -->
    <style>
        /* Seu estilo CSS aqui */
        
       
        
    </style>
</head>

<body>
<div class="container mt-4">
  <div class="row">
    <div class="col">
      <button type="button" class="btn btn-primary mb-3" data-toggle="modal" data-target="#taskModal">+</button>
  
        <!-- Formulário de Cadastro de Contas a Pagar -->
        <h2>Cadastro de Contas a Pagar</h2>
        <form id="contas-pagar-form">
            <div class="form-group">
                <label for="fornecedor-select">Fornecedor</label>
                <select id="fornecedor-select" class="form-control">
                    <!-- As opções de fornecedores serão preenchidas dinamicamente -->
                </select>
            </div>
            <div class="form-group">
                <label for="codigo_barras">Código de Barras</label>
                <input type="text" id="codigo_barras" class="form-control">
            </div>
            <div class="form-group">
                <label for="valor">Valor</label>
                <input type="number" id="valor" class="form-control" step="0.01" required>
            </div>
            <div class="form-group">
                <label for="data_vencimento">Data de Vencimento</label>
                <input type="date" id="data_vencimento" class="form-control">
            </div>
            <div class="form-group">
                <label for="data_pagamento">Data de Pagamento</label>
                <input type="date" id="data_pagamento" class="form-control">
            </div>
            <button type="submit" class="btn btn-primary">Cadastrar Conta</button>
        </form>

        <!-- Tabela de Contas a Pagar -->
        <h2>Lista de Contas a Pagar</h2>
        <table id="contas-pagar-table" class="table">
            <thead>
                <tr>
                    <th>Fornecedor</th>
                    <th>Código de Barras</th>
                    <th>Valor</th>
                    <th>Data de Vencimento</th>
                    <th>Data de Pagamento</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody>
                <!-- As linhas da tabela serão preenchidas dinamicamente -->
            </tbody>
        </table>
    </div>
 
    

<!-- Modal para o formulário de cadastro -->
    <div class="modal fade" id="taskModal" tabindex="-1" role="dialog" aria-labelledby="taskModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="taskModalLabel">Novo Fornecedor</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="fornecedor-form">
        <div class="form-group">
                <label for="fornecedor">Fornecedor</label>
                <input type="text" id="fornecedor" class="form-control" required>
            </div>
            <div class="form-group">
                <label for="vendedor">Vendedor</label>
                <input type="text" id="vendedor" class="form-control" required>
            </div>
            <div class="form-group">
                <label for="telefone">Telefone</label>
                <input type="tel" id="telefone" class="form-control">
            </div>
            
            
    
      
      <div class="modal-footer">
        <button type="submit" class="btn btn-primary">Cadastrar Fornecedor</button>
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
        
      </div>
   </form
  

 

    <!-- Adicione os scripts do Bootstrap e jQuery (necessário para o Bootstrap) -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <!-- Adicione este link ao head para incluir os ícones do Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
        integrity="sha512-2OG7IQb5LQSj+64I4Ifrqz9X3qWhgJgzvoUUg6bIyIiYpLZC2mh1I5i/r8i63tFna3x6MkFjuqalnKlQMqlLg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

  <!-- Configurações do Firebase e Firestore -->
  <script src="https://www.gstatic.com/firebasejs/8.7.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.7.0/firebase-firestore.js"></script>
  <script>
        // Configurações do seu projeto no Firebase
        var firebaseConfig = {
            apiKey: "AIzaSyC-AZzKXWy6_mvNcF8QZWuusTjpo6Dj2Hw",
      authDomain: "projetoweb-6232c.firebaseapp.com",
      databaseURL: "https://projetoweb-6232c.firebaseio.com",
      projectId: "projetoweb-6232c",
      storageBucket: "projetoweb-6232c.appspot.com",
      messagingSenderId: "341899111399",
      appId: "1:341899111399:web:3c5edd575a96808c786b42"
        };

        // Inicializa o app do Firebase
        firebase.initializeApp(firebaseConfig);

        // Inicializa o Firestore
        var db = firebase.firestore();

        // Referências aos elementos dos formulários e da tabela
        var fornecedorForm = document.getElementById("fornecedor-form");
        var fornecedorInput = document.getElementById("fornecedor");
        var vendedorInput = document.getElementById("vendedor");
        var telefoneInput = document.getElementById("telefone");
        var contasPagarForm = document.getElementById("contas-pagar-form");
        var fornecedorSelect = document.getElementById("fornecedor-select");
        var codigoBarrasInput = document.getElementById("codigo_barras");
        var valorInput = document.getElementById("valor");
        var dataVencimentoInput = document.getElementById("data_vencimento");
        var dataPagamentoInput = document.getElementById("data_pagamento");
        var contasPagarTable = document.getElementById("contas-pagar-table").getElementsByTagName('tbody')[0];

        // Função para cadastrar um fornecedor
        fornecedorForm.addEventListener("submit", function (event) {
            event.preventDefault();
            var fornecedor = fornecedorInput.value;
            var vendedor = vendedorInput.value;
            var telefone = telefoneInput.value;
            db.collection("fornecedores").add({
                fornecedor: fornecedor,
                vendedor: vendedor,
                telefone: telefone
            }).then(function (docRef) {
                fornecedorInput.value = "";
                vendedorInput.value = "";
                telefoneInput.value = "";
                loadFornecedoresDropdown();
                console.log("Fornecedor cadastrado com ID: ", docRef.id);
            }).catch(function (error) {
                console.error("Erro ao cadastrar fornecedor: ", error);
            });
        });

        // Função para carregar os fornecedores na lista suspensa
        function loadFornecedoresDropdown() {
            fornecedorSelect.innerHTML = '<option value="">Selecione um fornecedor...</option>';
            db.collection("fornecedores").get().then(function (querySnapshot) {
                querySnapshot.forEach(function (doc) {
                    var data = doc.data();
                    var option = document.createElement("option");
                    option.value = doc.id;
                    option.text = data.fornecedor;
                    fornecedorSelect.appendChild(option);
                });
            });
        }

        // Carrega os fornecedores na lista suspensa ao carregar a página
        loadFornecedoresDropdown();

        // Função para cadastrar uma conta a pagar
        contasPagarForm.addEventListener("submit", function (event) {
            event.preventDefault();
            var fornecedorId = fornecedorSelect.value;
            var codigoBarras = codigoBarrasInput.value;
            var valor = parseFloat(valorInput.value);
            var dataVencimento = dataVencimentoInput.value;
            var dataPagamento = dataPagamentoInput.value;
            db.collection("contas_pagar").add({
                fornecedorId: fornecedorId,
                codigoBarras: codigoBarras,
                valor: valor,
                dataVencimento: dataVencimento,
                dataPagamento: dataPagamento
            }).then(function (docRef) {
                fornecedorSelect.value = "";
                codigoBarrasInput.value = "";
                valorInput.value = "";
                dataVencimentoInput.value = "";
                dataPagamentoInput.value = "";
                console.log("Conta cadastrada com ID: ", docRef.id);
		loadContasPagarTable();
            }).catch(function (error) {
                console.error("Erro ao cadastrar conta: ", error);
            });
        });

        // Função para carregar as contas a pagar na tabela
        function loadContasPagarTable() {
            contasPagarTable.innerHTML = "";
            db.collection("contas_pagar").get().then(function (querySnapshot) {
                querySnapshot.forEach(function (doc) {
                    var data = doc.data();
                    var fornecedorRef = db.collection("fornecedores").doc(data.fornecedorId);
                    fornecedorRef.get().then(function (fornecedorDoc) {
                        var fornecedorData = fornecedorDoc.data();
                        var row = contasPagarTable.insertRow(-1);
                        var fornecedorCell = row.insertCell(0);
                        var codigoBarrasCell = row.insertCell(1);
                        var valorCell = row.insertCell(2);
                        var dataVencimentoCell = row.insertCell(3);
                        var dataPagamentoCell = row.insertCell(4);
                        var actionsCell = row.insertCell(5);
                        fornecedorCell.innerHTML = fornecedorData.fornecedor;
                        codigoBarrasCell.innerHTML = data.codigoBarras;
                        valorCell.innerHTML = data.valor.toFixed(2);
                        dataVencimentoCell.innerHTML = data.dataVencimento;
                        dataPagamentoCell.innerHTML = data.dataPagamento;
                        actionsCell.innerHTML = '<button class="btn btn-sm btn-danger" onclick="deleteConta(\'' + doc.id + '\')">Excluir</button>';
                    });
                });
            });
        }

        // Função para excluir uma conta a pagar
        function deleteConta(contaId) {
            db.collection("contas_pagar").doc(contaId).delete().then(function () {
                console.log("Conta excluída com sucesso!");
                loadContasPagarTable();
            }).catch(function (error) {
                console.error("Erro ao excluir conta: ", error);
            });
        }

        // Carrega as contas a pagar na tabela ao carregar a página
        loadContasPagarTable();
    </script>

    <!-- Adicione o link para o Bootstrap JavaScript no final do body -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    
</body>


</html>
