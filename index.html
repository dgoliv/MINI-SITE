<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de Fornecedores</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    
    <style>
    
    /* Estilo para os cards */
.card {
    background-color: #f5f5f5; /* Cor de fundo */
    border: none; /* Remover borda */
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* Sombra sutil */
    margin-bottom: 15px; /* Espaçamento entre os cards */
}

/* Estilo para os títulos dos cards */
.card-title {
    font-size: 1.2rem; /* Tamanho do título */
    margin-bottom: 0.5rem; /* Espaçamento inferior */
    color: #333; /* Cor do texto */
}

/* Estilo para o texto dos cards */
.card-text {
    color: #777; /* Cor do texto secundário */
}

/* Estilo para os botões dentro dos cards */
.card .btn {
    background-color: #007bff; /* Cor de fundo do botão */
    color: #fff; /* Cor do texto do botão */
    border: none; /* Remover borda do botão */
    padding: 5px 10px; /* Espaçamento interno do botão */
    font-size: 0.9rem; /* Tamanho da fonte do botão */
    cursor: pointer; /* Cursor de apontar */
}

/* Estilo para os botões de edição */
.card .btn-info {
    background-color: #17a2b8; /* Cor de fundo do botão de edição */
}

/* Estilo para os botões de exclusão */
.card .btn-danger {
    background-color: #dc3545; /* Cor de fundo do botão de exclusão */
}

    
    </style>
    
</head>
<body>
    <div class="container mt-5">
        
        <div class="row mt-5">
    <div class="col-md-3">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Contas Vencidas</h5>
                <p class="card-text" id="contasVencidasCount">Carregando...</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Contas para Hoje</h5>
                <p class="card-text" id="contasHojeCount">Carregando...</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Contas a Vencer</h5>
                <p class="card-text" id="contasAVencerCount">Carregando...</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
    <div class="card">
        <div class="card-body">
            <h5 class="card-title">Contas Pagas</h5>
            <p class="card-text" id="contasPagasCount">Carregando...</p>
        </div>
    </div>
</div>

    <div class="col-md-3">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Total de Contas</h5>
                <p class="card-text" id="totalContasCount">Carregando...</p>
            </div>
        </div>
    </div>
</div>

        
        <h2>Cadastro de Fornecedores</h2>
        <form id="cadastroForm">
            <div class="form-group">
                <label for="fornecedor">Fornecedor:</label>
                <input type="text" class="form-control" id="fornecedor" required>
            </div>
            <div class="form-group">
                <label for="vendedor">Vendedor:</label>
                <input type="text" class="form-control" id="vendedor" required>
            </div>
            <div class="form-group">
                <label for="telefone">Telefone:</label>
                <input type="text" class="form-control" id="telefone" required>
            </div>
            <button type="submit" class="btn btn-primary" id="cadastrarBtn">Cadastrar Fornecedor</button>
        </form>
        
        <div class="form-group mt-3">
    <label for="filtroFornecedores">Pesquisar Fornecedores:</label>
    <input type="text" class="form-control" id="filtroFornecedores" placeholder="Digite o nome do fornecedor" oninput="filtrarFornecedores()">
    </div>

        
        <h2 class="mt-5">Lista de Fornecedores</h2>
        <ul id="fornecedoresList" class="list-group">
            <!-- Lista de fornecedores será exibida aqui -->
        </ul>
    
    
    <form id="contasPagarForm">
    <div class="form-group">
        <label for="fornecedorSelect">Fornecedor:</label>
        <select class="form-control" id="fornecedorSelect" required>
            <!-- Opções de fornecedores serão carregadas aqui -->
        </select>
    </div>
    <div class="form-group">
        <label for="codigoBarras">Código de Barras:</label>
        <input type="text" class="form-control" id="codigoBarras" required>
    </div>
    <div class="form-group">
        <label for="dataVencimento">Data de Vencimento:</label>
        <input type="date" class="form-control" id="dataVencimento" required>
    </div>
    <div class="form-group">
        <label for="valor">Valor:</label>
        <input type="number" step="0.01" class="form-control" id="valor" required>
    </div>
    <div class="form-group">
        <label for="dataPagamento">Data de Pagamento:</label>
        <input type="date" class="form-control" id="dataPagamento">
    </div>
    <button type="submit" class="btn btn-primary">Cadastrar Conta</button>
</form>

<div class="form-group mt-3">
<label for="dataVencimentoInicial">Data de Vencimento Inicial:</label>
<input type="date" class="form-control" id="dataVencimentoInicial">

<label for="dataVencimentoFinal">Data de Vencimento Final:</label>
<input type="date" class="form-control" id="dataVencimentoFinal">

<label for="dataPagamentoInicial">Data de Pagamento Inicial:</label>
<input type="date" class="form-control" id="dataPagamentoInicial">

<label for="dataPagamentoFinal">Data de Pagamento Final:</label>
<input type="date" class="form-control" id="dataPagamentoFinal">


<button type="button" class="btn btn-primary mt-2" id="filtrarContasBtn">Filtrar Contas</button>



<ul id="contasPagarList" class="list-group">
    <!-- Lista de contas a pagar será exibida aqui -->
</ul>


</div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script>
        const firebaseConfig = {
        apiKey: "AIzaSyC-AZzKXWy6_mvNcF8QZWuusTjpo6Dj2Hw",
        authDomain: "projetoweb-6232c.firebaseapp.com",
        databaseURL: "https://projetoweb-6232c.firebaseio.com",
        projectId: "projetoweb-6232c",
        storageBucket: "projetoweb-6232c.appspot.com",
        messagingSenderId: "341899111399",
        appId: "1:341899111399:web:3c5edd575a96808c786b42"
        };

        firebase.initializeApp(firebaseConfig);

        const db = firebase.firestore();
        const cadastroForm = document.getElementById('cadastroForm');
        const fornecedoresList = document.getElementById('fornecedoresList');
        const cadastrarBtn = document.getElementById('cadastrarBtn');
        let editingItemId = null;
        const fornecedorSelect = document.getElementById('fornecedorSelect');
        const contasPagarForm = document.getElementById('contasPagarForm');
   
    const codigoBarras = document.getElementById('codigoBarras');
    const dataVencimento = document.getElementById('dataVencimento');
    const valor = document.getElementById('valor');
    const dataPagamento = document.getElementById('dataPagamento');
    const cadastrarContaBtn = document.querySelector('#contasPagarForm button[type="submit"]');
    let editingItemIdConta = null;

        cadastroForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const fornecedor = document.getElementById('fornecedor').value;
            const vendedor = document.getElementById('vendedor').value;
            const telefone = document.getElementById('telefone').value;

            if (editingItemId) {
                await db.collection('fornecedores').doc(editingItemId).update({
                    fornecedor,
                    vendedor,
                    telefone
                });

                cadastrarBtn.textContent = "Cadastrar Fornecedor";
                editingItemId = null;
            } else {
                await db.collection('fornecedores').add({
                    fornecedor,
                    vendedor,
                    telefone
                });
            }

            cadastroForm.reset();
        });

        db.collection('fornecedores').onSnapshot(snapshot => {
        fornecedorSelect.innerHTML = ''; // Limpa a lista suspensa antes de adicionar novos itens
        fornecedoresList.innerHTML = '';
        snapshot.forEach(doc => {
        const data = doc.data();
        const option = document.createElement('option');
        option.textContent = data.fornecedor;
        fornecedorSelect.appendChild(option);
        const listItem = document.createElement('li');
        listItem.classList.add('list-group-item');
        listItem.innerHTML = `
                    
                    
                    <strong>Fornecedor:</strong>
                    <strong class="fornecedor-nome">${data.fornecedor}</strong><br>
                    <strong>Vendedor:</strong> ${data.vendedor}<br>
                    <strong>Telefone:</strong> ${data.telefone}<br>
                    
                    <button class="btn btn-sm btn-info ml-2 editar-btn" data-id="${doc.id}">Editar</button>
                    <button class="btn btn-sm btn-danger ml-2 excluir-btn" data-id="${doc.id}">Excluir</button>
                `;
                fornecedoresList.appendChild(listItem);
            });

            const editarButtons = document.querySelectorAll('.editar-btn');
            const excluirButtons = document.querySelectorAll('.excluir-btn');

            editarButtons.forEach(btn => {
                btn.addEventListener('click', async (e) => {
                    const id = e.target.getAttribute('data-id');
                    editingItemId = id;
                    const doc = await db.collection('fornecedores').doc(id).get();
                    const data = doc.data();
                    document.getElementById('fornecedor').value = data.fornecedor;
                    document.getElementById('vendedor').value = data.vendedor;
                    document.getElementById('telefone').value = data.telefone;
                    cadastrarBtn.textContent = "Salvar Edições";
                });
            });

            excluirButtons.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = e.target.getAttribute('data-id');
                    db.collection('fornecedores').doc(id).delete();
                });
            });
            
            contasPagarForm.addEventListener('submit', async (e) => {
    e.preventDefault();

    const fornecedorId = fornecedorSelect.value;
    const codigo = codigoBarras.value;
    const vencimento = dataVencimento.value;
    const valorConta = parseFloat(valor.value);
    const pagamento = dataPagamento.value;
   


    

    if (editingItemIdConta) {
        await db.collection('contasPagar').doc(editingItemIdConta).update({
            fornecedorId,
            codigo,
            vencimento,
            valor: valorConta,
            pagamento
        });

        cadastrarContaBtn.textContent = "Cadastrar Conta";
        editingItemIdConta = null;
    } else {
        await db.collection('contasPagar').add({
            fornecedorId,
            codigo,
            vencimento,
            valor: valorConta,
            pagamento
        });
    }

    contasPagarForm.reset();
});

            
        });
        
        
        
        
        db.collection('contasPagar').onSnapshot(snapshot => {
    contasPagarList.innerHTML = '';
    snapshot.forEach(doc => {
        const data = doc.data();
        const dataVencimentoFormatada = new Date(data.vencimento + 'T00:00:00').toLocaleDateString('pt-BR', {
            day: '2-digit',
            month: '2-digit',
            year: 'numeric'
        });

        const dataPagamentoFormatada = data.pagamento ? new Date(data.pagamento + 'T00:00:00').toLocaleDateString('pt-BR', {
            day: '2-digit',
            month: '2-digit',
            year: 'numeric'
        }) : 'Não pago';

        const listItem = document.createElement('li');
        listItem.classList.add('list-group-item');
        listItem.setAttribute('data-vencimento', data.vencimento); // Adicionar o atributo data-vencimento
        listItem.setAttribute('data-pagamento', data.pagamento || ''); // Adicionar o atributo data-pagamento (ou vazio se não houver pagamento)
        listItem.innerHTML = `
            <strong>Fornecedor:</strong> ${data.fornecedorId}<br>
            <strong>Código de Barras:</strong> ${data.codigo}<br>
            <strong>Data de Vencimento:</strong> ${dataVencimentoFormatada}<br>
            <strong>Valor:</strong> R$ ${data.valor.toFixed(2)}<br>
            <strong>Data de Pagamento:</strong> ${dataPagamentoFormatada}<br>
            <button class="btn btn-sm btn-info ml-2 editar-conta-btn" data-id="${doc.id}">Editar</button>
            <button class="btn btn-sm btn-danger ml-2 excluir-conta-btn" data-id="${doc.id}">Excluir</button>
        `;
        contasPagarList.appendChild(listItem);
    });

   const editarContaButtons = document.querySelectorAll('.editar-conta-btn');
    const excluirContaButtons = document.querySelectorAll('.excluir-conta-btn');

    editarContaButtons.forEach(btn => {
        btn.addEventListener('click', async (e) => {
            const id = e.target.getAttribute('data-id');
            editingItemIdConta = id;
            const doc = await db.collection('contasPagar').doc(id).get();
            const data = doc.data();
            fornecedorSelect.value = data.fornecedorId;
            codigoBarras.value = data.codigo;
            dataVencimento.value = data.vencimento;
            valor.value = data.valor;
            dataPagamento.value = data.pagamento;
            cadastrarContaBtn.textContent = "Salvar Edições";
        });
    });

    excluirContaButtons.forEach(btn => {
        btn.addEventListener('click', async (e) => {
            const id = e.target.getAttribute('data-id');
            await db.collection('contasPagar').doc(id).delete();
        });
    });
    
    // Atualizar os cards no topo com informações sobre os valores das contas
// Função para formatar a data em formato pt-BR
function formatarData(data) {
    const options = { year: 'numeric', month: '2-digit', day: '2-digit' };
    return new Intl.DateTimeFormat('pt-BR', options).format(data);
}

// Atualizar os cards no topo com informações sobre os valores das contas
db.collection('contasPagar').onSnapshot(snapshot => {
    const hoje = new Date();
    let totalContasVencidas = 0;
    let totalContasHoje = 0;
    let totalContasAVencer = 0;
    let totalContasPagas = 0;

    snapshot.docs.forEach(doc => {
        const data = doc.data();
        const dataVencimento = new Date(data.vencimento + 'T00:00:00');
        const valorConta = data.valor;
        const dataPagamento = data.pagamento ? new Date(data.pagamento + 'T00:00:00') : null;
        
       if (dataVencimento.toDateString() === hoje.toDateString()) {
            if (!dataPagamento) {
                totalContasHoje += valorConta;
            }
        } else if (dataVencimento < hoje) {
            if (!dataPagamento)
            totalContasVencidas += valorConta;
        } else if (!dataPagamento){
            totalContasAVencer += valorConta;
        }
        if (data.pagamento) {
            totalContasPagas += data.valor;
        }
    });

    const totalContas = totalContasVencidas + totalContasHoje + totalContasAVencer + totalContasPagas;

    document.getElementById('contasVencidasCount').textContent = `R$ ${totalContasVencidas.toFixed(2)}`;
    document.getElementById('contasHojeCount').textContent = `R$ ${totalContasHoje.toFixed(2)} (${formatarData(hoje)})`;
    document.getElementById('contasAVencerCount').textContent = `R$ ${totalContasAVencer.toFixed(2)}`;
    document.getElementById('totalContasCount').textContent = `R$ ${totalContas.toFixed(2)}`;
    document.getElementById('contasPagasCount').textContent = `R$ ${totalContasPagas.toFixed(2)}`;
    
});

    function filtrarFornecedores() {
        const filtroInput = document.getElementById('filtroFornecedores');
        const fornecedoresList = document.getElementById('fornecedoresList');
        const fornecedoresItens = fornecedoresList.getElementsByClassName('list-group-item');

        const filtro = filtroInput.value.toLowerCase();

        for (const item of fornecedoresItens) {
            const fornecedorNome = item.querySelector('.fornecedor-nome').textContent.toLowerCase();
            if (fornecedorNome.includes(filtro)) {
                item.style.display = 'block';
            } else {
                item.style.display = 'none';
            }
        }
    }


document.getElementById('filtroFornecedores').addEventListener('input', filtrarFornecedores);

    
    


});


// Selecionar os elementos de input para as datas de vencimento e pagamento
const dataVencimentoInicial = document.getElementById('dataVencimentoInicial');
const dataVencimentoFinal = document.getElementById('dataVencimentoFinal');
const dataPagamentoInicial = document.getElementById('dataPagamentoInicial');
const dataPagamentoFinal = document.getElementById('dataPagamentoFinal');
const filtrarContasBtn = document.getElementById('filtrarContasBtn');

// Função para atualizar a lista de contas a pagar com base nos filtros de data
filtrarContasBtn.addEventListener('click', () => {
    const contasPagarList = document.getElementById('contasPagarList');
    const contasItens = contasPagarList.getElementsByClassName('list-group-item');

    const filtroDataVencimentoInicial = dataVencimentoInicial.value ? new Date(dataVencimentoInicial.value) : null;
    const filtroDataVencimentoFinal = dataVencimentoFinal.value ? new Date(dataVencimentoFinal.value) : null;
    const filtroDataPagamentoInicial = dataPagamentoInicial.value ? new Date(dataPagamentoInicial.value) : null;
    const filtroDataPagamentoFinal = dataPagamentoFinal.value ? new Date(dataPagamentoFinal.value) : null;

    for (const item of contasItens) {
        const dataVencimento = new Date(item.getAttribute('data-vencimento'));
        const dataPagamento = new Date(item.getAttribute('data-pagamento'));

        const vencimentoDentroDoFiltro = (
            (!filtroDataVencimentoInicial || dataVencimento >= filtroDataVencimentoInicial) &&
            (!filtroDataVencimentoFinal || dataVencimento <= filtroDataVencimentoFinal)
        );

        const pagamentoDentroDoFiltro = (
            (!filtroDataPagamentoInicial || dataPagamento >= filtroDataPagamentoInicial) &&
            (!filtroDataPagamentoFinal || dataPagamento <= filtroDataPagamentoFinal)
        );

        if ((vencimentoDentroDoFiltro && pagamentoDentroDoFiltro) || (!filtroDataVencimentoInicial && !filtroDataVencimentoFinal && !filtroDataPagamentoInicial && !filtroDataPagamentoFinal)) {
            item.style.display = 'block';
        } else {
            item.style.display = 'none';
        }
    }
});

// Adicionar evento de clique para o botão de filtragem
filtrarContasBtn.addEventListener('click', filtrarContas);

        
   </script>
</body>
</html>
